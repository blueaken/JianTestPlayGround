refer previous notes and improve the previous code